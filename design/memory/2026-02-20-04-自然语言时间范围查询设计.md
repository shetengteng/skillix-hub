# è‡ªç„¶è¯­è¨€æ—¶é—´èŒƒå›´æŸ¥è¯¢è®¾è®¡

> æ—¥æœŸï¼š2026-02-20
> çŠ¶æ€ï¼šè®¾è®¡ä¸­

## 1. éœ€æ±‚èƒŒæ™¯

ç”¨æˆ·å¸Œæœ›é€šè¿‡è‡ªç„¶è¯­è¨€è¯¢é—®"æœ€è¿‘1ä¸ªæœˆåšäº†ä»€ä¹ˆ"è¿™ç±»æ—¶é—´èŒƒå›´æŸ¥è¯¢ã€‚å½“å‰ç³»ç»Ÿéƒ¨åˆ†æ”¯æŒæ­¤åŠŸèƒ½ï¼Œéœ€è¦è¡¥é½ç¼ºå¤±éƒ¨åˆ†å¹¶åœ¨ SKILL.md / rules ä¸­æ·»åŠ å¼•å¯¼è§„åˆ™ã€‚

## 2. çŽ°çŠ¶åˆ†æž

### 2.1 å·²æ”¯æŒæ—¶é—´èŒƒå›´çš„å‘½ä»¤

| å‘½ä»¤ | å‚æ•° | è¯´æ˜Ž |
|---|---|---|
| `manage list` | `--days N` | æœ€è¿‘ N å¤© |
| `manage list` | `--from YYYY-MM-DD` | èµ·å§‹æ—¥æœŸ |
| `manage list` | `--to YYYY-MM-DD` | ç»“æŸæ—¥æœŸ |
| `manage list` | `--before YYYY-MM-DD` | æ—©äºŽæŸæ—¥ |
| `manage delete` | `--from`ã€`--to`ã€`--before` | åŒä¸Š |

### 2.2 ä¸æ”¯æŒæ—¶é—´èŒƒå›´çš„å‘½ä»¤

| å‘½ä»¤ | çŽ°æœ‰å‚æ•° | ç¼ºå¤± |
|---|---|---|
| `search_memory.py` | `query`ã€`--max-results`ã€`--method` | æ—  `--days`/`--from`/`--to` |
| `manage export` | `--output`ã€`--scope`ã€`--type` | æ— æ—¶é—´è¿‡æ»¤ |

### 2.3 è§„åˆ™å¼•å¯¼ç¼ºå¤±

`SKILL.md` å’Œ `memory-rules.mdc` ä¸­æ²¡æœ‰è¯´æ˜Žå¦‚ä½•å“åº”æ—¶é—´èŒƒå›´æŸ¥è¯¢ï¼ŒAgent ä¸çŸ¥é“è¯¥ç”¨å“ªä¸ªå‘½ä»¤ã€‚

## 3. è®¾è®¡æ–¹æ¡ˆ

### 3.1 æ–¹æ¡ˆæ¦‚è¿°

åˆ†ä¸‰å±‚å®žçŽ°ï¼š

```
ç”¨æˆ·è‡ªç„¶è¯­è¨€ â†’ Agent è§£æžæ„å›¾ â†’ é€‰æ‹©åˆé€‚å‘½ä»¤ â†’ è¿”å›žç»“æžœ
                    â†‘
              SKILL.md è§„åˆ™å¼•å¯¼
```

### 3.2 SKILL.md æ–°å¢žè§„åˆ™

åœ¨ SKILL.md çš„"æ‰‹åŠ¨è¡Œä¸º"éƒ¨åˆ†æ–°å¢ž"æ—¶é—´èŒƒå›´æŸ¥è¯¢"ç« èŠ‚ï¼š

```markdown
### ç”¨æˆ·è¯¢é—®æ—¶é—´èŒƒå›´å†…çš„æ´»åŠ¨

å½“ç”¨æˆ·é—®"æœ€è¿‘ N å¤©/å‘¨/æœˆåšäº†ä»€ä¹ˆ"ã€"ä¸Šå‘¨çš„è®°å¿†"ç­‰æ—¶é—´èŒƒå›´æŸ¥è¯¢æ—¶ï¼š

**æ„å›¾æ˜ å°„ï¼š**

| ç”¨æˆ·å¯èƒ½çš„è¯´æ³• | å¯¹åº”å‘½ä»¤ |
|---|---|
| "æœ€è¿‘1ä¸ªæœˆåšäº†ä»€ä¹ˆ" | `manage list --days 30` |
| "æœ€è¿‘ä¸€å‘¨çš„è®°å¿†" | `manage list --days 7` |
| "ä¸Šä¸ªæœˆçš„å†³ç­–" | `manage list --from 2026-01-01 --to 2026-01-31 --type W` |
| "2æœˆä»½åšäº†ä»€ä¹ˆ" | `manage list --from 2026-02-01 --to 2026-02-28` |
| "ä»Šå¤©çš„è®°å¿†" | `manage list --days 1` |
| "æœç´¢æœ€è¿‘ä¸€å‘¨å…³äºŽæ•°æ®åº“çš„è®°å¿†" | `search_memory.py "æ•°æ®åº“" --days 7`ï¼ˆéœ€æ‰©å±•ï¼‰ |

**æ‰§è¡Œæµç¨‹ï¼š**

1. è§£æžç”¨æˆ·æ„å›¾ï¼Œç¡®å®šæ—¶é—´èŒƒå›´å’Œå¯é€‰å…³é”®è¯
2. å¦‚æžœåªéœ€è¦åˆ—å‡º/æµè§ˆ â†’ ä½¿ç”¨ `manage list`
3. å¦‚æžœéœ€è¦è¯­ä¹‰æœç´¢ + æ—¶é—´è¿‡æ»¤ â†’ ä½¿ç”¨ `search_memory.py`ï¼ˆæ‰©å±•åŽï¼‰
4. æ ¼å¼åŒ–è¾“å‡ºï¼ŒæŒ‰æ—¶é—´å€’åºå±•ç¤º
```

### 3.3 search_memory.py æ‰©å±•

æ–°å¢žå¯é€‰å‚æ•°ï¼š

```python
parser.add_argument("--days", type=int, help="é™åˆ¶æœç´¢æœ€è¿‘ N å¤©çš„è®°å¿†")
parser.add_argument("--from", dest="from_date", help="èµ·å§‹æ—¥æœŸ YYYY-MM-DD")
parser.add_argument("--to", help="ç»“æŸæ—¥æœŸ YYYY-MM-DD")
```

åœ¨ `sqlite_search.py` çš„æœç´¢å‡½æ•°ä¸­ï¼Œå¯¹ `chunks.timestamp` æ·»åŠ  WHERE æ¡ä»¶ï¼š

```python
def _build_time_filter(days=None, from_date=None, to_date=None):
    """æž„å»ºæ—¶é—´è¿‡æ»¤ SQL æ¡ä»¶"""
    conditions = []
    params = []
    if days:
        cutoff = (datetime.utcnow() - timedelta(days=days)).strftime("%Y-%m-%dT%H:%M:%S")
        conditions.append("timestamp >= ?")
        params.append(cutoff)
    if from_date:
        conditions.append("timestamp >= ?")
        params.append(from_date + "T00:00:00")
    if to_date:
        conditions.append("timestamp <= ?")
        params.append(to_date + "T23:59:59")
    return conditions, params
```

å½±å“èŒƒå›´ï¼š
- `search_fts()` - å…¨æ–‡æœç´¢æ·»åŠ æ—¶é—´è¿‡æ»¤
- `search_vector()` - å‘é‡æœç´¢æ·»åŠ æ—¶é—´è¿‡æ»¤
- `hybrid_search()` - æ··åˆæœç´¢æ·»åŠ æ—¶é—´è¿‡æ»¤

### 3.4 manage export æ‰©å±•

æ–°å¢žæ—¶é—´è¿‡æ»¤å‚æ•°ï¼š

```python
p = sub.add_parser("export")
p.add_argument("--days", type=int)
p.add_argument("--from", dest="from_date")
p.add_argument("--to")
```

åœ¨ `cmd_export.py` ä¸­å¤ç”¨ `filter_entries()` åšæ—¥æœŸè¿‡æ»¤ã€‚

### 3.5 memory-rules.mdc æ›´æ–°

åœ¨è§„åˆ™æ–‡ä»¶ä¸­æ·»åŠ æ—¶é—´èŒƒå›´æŸ¥è¯¢çš„è§¦å‘è¯ï¼š

```
è§¦å‘è¯ï¼šæœ€è¿‘ã€ä¸Šå‘¨ã€ä¸Šä¸ªæœˆã€è¿™å‘¨ã€ä»Šå¤©ã€Nå¤©å‰ã€æ—¶é—´èŒƒå›´
```

## 4. å®žçŽ°ä¼˜å…ˆçº§

| ä¼˜å…ˆçº§ | ä»»åŠ¡ | å·¥ä½œé‡ |
|---|---|---|
| P0 | SKILL.md æ·»åŠ æ—¶é—´èŒƒå›´æŸ¥è¯¢è§„åˆ™ | å° |
| P0 | memory-rules.mdc æ·»åŠ è§¦å‘è¯ | å° |
| P1 | search_memory.py æ·»åŠ æ—¶é—´è¿‡æ»¤å‚æ•° | ä¸­ |
| P2 | manage export æ·»åŠ æ—¶é—´è¿‡æ»¤ | å° |

P0 ä»»åŠ¡ä»…éœ€ä¿®æ”¹æ–‡æ¡£/è§„åˆ™ï¼ŒAgent å³å¯é€šè¿‡ `manage list --days N` å“åº”æ—¶é—´èŒƒå›´æŸ¥è¯¢ã€‚

P1 ä»»åŠ¡æ‰©å±• `search_memory.py`ï¼Œä½¿"æœç´¢æœ€è¿‘ä¸€å‘¨å…³äºŽ XX çš„è®°å¿†"è¿™ç§ç»„åˆæŸ¥è¯¢æˆä¸ºå¯èƒ½ã€‚

## 5. äº¤äº’ç¤ºä¾‹

### ç¤ºä¾‹ 1ï¼šç®€å•æ—¶é—´èŒƒå›´æŸ¥è¯¢

```
ç”¨æˆ·ï¼šæœ€è¿‘1ä¸ªæœˆåšäº†ä»€ä¹ˆï¼Ÿ

Agent æ‰§è¡Œï¼š
  python3 manage/index.py list --days 30

Agent å›žå¤ï¼š
  æœ€è¿‘ 30 å¤©çš„è®°å¿†è®°å½•ï¼š

  ðŸ“… 2026-02-20
  â€¢ [W] å®žçŽ°äº† .memory-disable é¡¹ç›®çº§ç¦ç”¨åŠŸèƒ½
  â€¢ [W] æ·»åŠ äº† MEMORY.md è‡ªåŠ¨åˆå§‹åŒ–é€»è¾‘

  ðŸ“… 2026-02-19
  â€¢ [S] ä¼šè¯æ‘˜è¦ï¼šæµ‹è¯•ä»£ç æ•´åˆé‡æž„
  â€¢ [W] ç»Ÿä¸€äº†æµ‹è¯•ç›®å½•ç»“æž„

  ðŸ“… 2026-02-18
  â€¢ [W] å®Œæˆäº† Memory Skill å®‰è£…è„šæœ¬
  ...

  å…± 47 æ¡è®°å½•ï¼Œæ¶µç›– 15 ä¸ªä¼šè¯ã€‚
```

### ç¤ºä¾‹ 2ï¼šå¸¦å…³é”®è¯çš„æ—¶é—´èŒƒå›´æŸ¥è¯¢ï¼ˆP1 å®žçŽ°åŽï¼‰

```
ç”¨æˆ·ï¼šæœç´¢æœ€è¿‘ä¸€å‘¨å…³äºŽæ•°æ®åº“çš„è®¨è®º

Agent æ‰§è¡Œï¼š
  python3 search_memory.py "æ•°æ®åº“" --days 7

Agent å›žå¤ï¼š
  æœ€è¿‘ 7 å¤©å…³äºŽ"æ•°æ®åº“"çš„è®°å¿†ï¼š

  1. [W] é¡¹ç›®ç»Ÿä¸€ä½¿ç”¨ PostgreSQLï¼ˆç½®ä¿¡åº¦ 0.95ï¼‰
     æ—¥æœŸ: 2026-02-18

  2. [W] æ•°æ®åº“è¿žæŽ¥æ± æœ€å¤§ 20 è¿žæŽ¥
     æ—¥æœŸ: 2026-02-17

  å…± 2 æ¡ç›¸å…³è®°å¿†ã€‚
```

## 6. é£Žé™©ä¸Žæ³¨æ„äº‹é¡¹

- `manage list --days 30` å¯èƒ½è¿”å›žå¤§é‡æ•°æ®ï¼Œéœ€è¦é…åˆ `--limit` ä½¿ç”¨
- æ—¶é—´è¿‡æ»¤åŸºäºŽ `timestamp` å­—æ®µï¼Œæ ¼å¼ä¸º ISO 8601ï¼Œéœ€ç¡®ä¿ä¸€è‡´æ€§
- `search_memory.py` çš„æ—¶é—´è¿‡æ»¤åœ¨ SQLite å±‚é¢å®žçŽ°ï¼Œä¸å½±å“å‘é‡æœç´¢çš„å¬å›žçŽ‡
