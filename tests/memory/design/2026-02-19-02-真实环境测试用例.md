# Memory Skill çœŸå® Cursor ç¯å¢ƒæµ‹è¯•ç”¨ä¾‹

> **æ—¥æœŸ**: 2026-02-19
> **ç›®çš„**: ä»ç”¨æˆ·è‡ªç„¶è¯­è¨€äº¤äº’çš„è§’åº¦ï¼ŒéªŒè¯ Memory Skill åœ¨çœŸå® Cursor ä¸­çš„å®Œæ•´å·¥ä½œæµç¨‹
> **æºç **: `skills/memory/scripts/`
> **æ•°æ®ç›®å½•**: `.cursor/skills/memory-data/`

---

## 1. å®‰è£…ä¸åˆå§‹åŒ–

### TC-1.1 é€šè¿‡è‡ªç„¶è¯­è¨€å®‰è£…

**ç”¨æˆ·è¾“å…¥**:
```
å¸®æˆ‘ä» https://github.com/shetengteng/skillix-hub å®‰è£… memory skill
```

**é¢„æœŸ Agent è¡Œä¸º**:
1. å…‹éš†ä»“åº“
2. å¤åˆ¶ `skills/memory` åˆ° `~/.cursor/skills/`
3. æ‰§è¡Œ `python3 ~/.cursor/skills/memory/scripts/service/init/index.py`

**é¢„æœŸ Agent å›å¤**ï¼ˆç¤ºæ„ï¼‰:
```
æ­£åœ¨å®‰è£… Memory Skill...

1. å…‹éš†ä»“åº“åˆ°ä¸´æ—¶ç›®å½•
2. å¤åˆ¶ skills/memory åˆ° ~/.cursor/skills/
3. è¿è¡Œåˆå§‹åŒ–è„šæœ¬

âœ… Memory Skill å®‰è£…æˆåŠŸï¼

å·²é…ç½®ï¼š
â€¢ sessionStart Hook â†’ æ–°ä¼šè¯å¼€å§‹æ—¶è‡ªåŠ¨åŠ è½½è®°å¿†
â€¢ preCompact Hook â†’ ä¸Šä¸‹æ–‡å‹ç¼©å‰ä¿å­˜å…³é”®äº‹å®
â€¢ stop Hook â†’ ä¼šè¯ç»“æŸæ—¶ä¿å­˜æ‘˜è¦
â€¢ memory-rules.mdc â†’ å¼•å¯¼ Agent æ‰§è¡Œè®°å¿†æ“ä½œ
```

**éªŒè¯**:
- [x] `.cursor/hooks.json` åŒ…å« sessionStart / preCompact / stop ä¸‰ä¸ª Hook
- [x] `.cursor/rules/memory-rules.mdc` å­˜åœ¨
- [x] `.cursor/skills/memory-data/` ç›®å½•å·²åˆ›å»º
- [x] `.cursor/skills/memory-data/MEMORY.md` å·²åˆ›å»º

```bash
cat .cursor/hooks.json | python3 -m json.tool
ls -la .cursor/rules/memory-rules.mdc
ls -la .cursor/skills/memory-data/
```

---

## 2. è‡ªåŠ¨è®°å¿†åŠ è½½ï¼ˆsessionStartï¼‰

### TC-2.1 æ–°ä¼šè¯å¼€å§‹æ—¶è‡ªåŠ¨åŠ è½½

**å‰ç½®å‡†å¤‡**: åœ¨ `MEMORY.md` ä¸­å†™å…¥ï¼š
```markdown
# æ ¸å¿ƒè®°å¿†
- é¡¹ç›®ä½¿ç”¨ FastAPI + PostgreSQL
- ç”¨æˆ·åå¥½ Python å’Œ TypeScript
```

**ç”¨æˆ·è¾“å…¥**ï¼ˆæ–°ä¼šè¯å¼€å§‹åçš„ç¬¬ä¸€å¥è¯ï¼‰:
```
ç»§ç»­æ˜¨å¤©çš„ API å¼€å‘
```

**é¢„æœŸ Agent å›å¤**ï¼ˆç¤ºæ„ï¼‰:
```
ï¼ˆsessionStart Hook å·²è‡ªåŠ¨åŠ è½½è®°å¿†ä¸Šä¸‹æ–‡ï¼‰

æ ¹æ®ä¹‹å‰çš„è®°å¿†ï¼Œä½ çš„é¡¹ç›®ä½¿ç”¨ FastAPI + PostgreSQL æ¶æ„ã€‚

è®©æˆ‘çœ‹çœ‹ä¸Šæ¬¡çš„è¿›åº¦... ä¸Šæ¬¡ä¼šè¯æˆ‘ä»¬è®¨è®ºäº†ç”¨æˆ·è®¤è¯æ¨¡å—ã€‚
éœ€è¦æˆ‘ä»å“ªé‡Œç»§ç»­ï¼Ÿ
```

**ä¼šè¯ demo**:

| è§’è‰² | å†…å®¹ |
|------|------|
| **ç³»ç»Ÿ** | _(sessionStart Hook è‡ªåŠ¨è§¦å‘ï¼Œload_memory.py è¿”å› MEMORY.md + è¿‘æœŸäº‹å® + ä¸Šæ¬¡æ‘˜è¦)_ |
| **ç”¨æˆ·** | ç»§ç»­æ˜¨å¤©çš„ API å¼€å‘ |
| **Agent** | æ ¹æ®è®°å¿†ï¼Œä½ çš„é¡¹ç›®ä½¿ç”¨ FastAPI + PostgreSQLã€‚ä¸Šæ¬¡æˆ‘ä»¬å®Œæˆäº†ç”¨æˆ·æ¨¡å—çš„ CRUDã€‚ä»Šå¤©è¦ç»§ç»­å“ªä¸ªæ¨¡å—ï¼Ÿ |
| **ç”¨æˆ·** | åšè®¢å•æ¨¡å—å§ |
| **Agent** | å¥½çš„ï¼Œå¼€å§‹è®¾è®¡è®¢å•æ¨¡å—çš„ API... |

**éªŒè¯**:
- [x] Agent çš„å›å¤ä½“ç°äº†å¯¹é¡¹ç›®çš„"å·²æœ‰è®¤çŸ¥"
- [x] daily/ ç›®å½•ä¸‹å½“å¤© JSONL æ–°å¢ `session_start` è®°å½•

---

## 3. äº‹å®è‡ªåŠ¨ä¿å­˜ï¼ˆpreCompactï¼‰

### TC-3.1 é•¿å¯¹è¯ä¸­è‡ªåŠ¨ä¿å­˜äº‹å®

**åœºæ™¯**: ä¸ Agent è¿›è¡Œè¾ƒé•¿å¯¹è¯ï¼Œè®¨è®ºå¤šä¸ªæŠ€æœ¯å†³ç­–ã€‚å½“ä¸Šä¸‹æ–‡æ¥è¿‘å‹ç¼©é˜ˆå€¼æ—¶ï¼ŒpreCompact Hook è‡ªåŠ¨è§¦å‘ã€‚

**ä¼šè¯ demo**:

| è§’è‰² | å†…å®¹ |
|------|------|
| **ç”¨æˆ·** | å¸®æˆ‘è®¾è®¡è®¢å•æ¨¡å— |
| **Agent** | å¥½çš„ï¼Œè®¢å•æ¨¡å—éœ€è¦ä»¥ä¸‹è¡¨... |
| **ç”¨æˆ·** | è®¢å•çŠ¶æ€ç”¨æšä¸¾ï¼Œä¸è¦ç”¨å­—ç¬¦ä¸² |
| **Agent** | æ˜ç™½ï¼Œä½¿ç”¨ Enum ç±»å‹... |
| **ç”¨æˆ·** | æ•°æ®åº“ç”¨ PostgreSQL çš„ ENUM ç±»å‹ |
| **Agent** | å¥½çš„ï¼Œä½¿ç”¨ PostgreSQL çš„åŸç”Ÿ ENUM... |
| _...å¤šè½®å¯¹è¯..._ | |
| **ç³»ç»Ÿ** | _(preCompact Hook è§¦å‘ï¼Œflush_memory.py æ³¨å…¥ [Memory Flush] æ¶ˆæ¯)_ |
| **Agent** | _(é™é»˜æ‰§è¡Œï¼Œç”¨æˆ·ä¸å¯è§)_ å›é¡¾å¯¹è¯ï¼Œæå–äº‹å®ï¼š<br>â€¢ `save_fact --content "è®¢å•çŠ¶æ€ä½¿ç”¨ PostgreSQL ENUM ç±»å‹" --type W`<br>â€¢ `save_fact --content "ç”¨æˆ·åå¥½å¼ºç±»å‹çº¦æŸ" --type O --confidence 0.85` |
| **ç”¨æˆ·** | _(ç»§ç»­æ­£å¸¸å¯¹è¯ï¼Œä¸æ„ŸçŸ¥ä¸Šè¿°æ“ä½œ)_ |

**é¢„æœŸ**: Agent é™é»˜ä¿å­˜ï¼Œç”¨æˆ·ä¸ä¼šçœ‹åˆ°ä»»ä½•å…³äºè®°å¿†æ“ä½œçš„æç¤ºã€‚

**éªŒè¯**:
```bash
tail -5 .cursor/skills/memory-data/daily/$(date +%Y-%m-%d).jsonl | python3 -m json.tool
```
- [ ] æ–°å¢çš„äº‹å®æ¡ç›®åŒ…å« content / type / entities
- [ ] ç”¨æˆ·å¯¹è¯æµç¨‹ä¸å—å½±å“

---

## 4. ä¼šè¯æ‘˜è¦ä¿å­˜ï¼ˆstopï¼‰

### TC-4.1 ä»»åŠ¡å®Œæˆåè‡ªåŠ¨ä¿å­˜æ‘˜è¦

**ä¼šè¯ demo**:

| è§’è‰² | å†…å®¹ |
|------|------|
| **ç”¨æˆ·** | å¥½çš„ï¼Œè®¢å•æ¨¡å—åšå®Œäº†ï¼Œä»Šå¤©å°±åˆ°è¿™é‡Œ |
| **Agent** | å¥½çš„ï¼ä»Šå¤©æˆ‘ä»¬å®Œæˆäº†è®¢å•æ¨¡å—çš„è®¾è®¡å’Œå®ç°ï¼ŒåŒ…æ‹¬...<br><br>å†è§ï¼ |
| **ç³»ç»Ÿ** | _(stop Hook è§¦å‘ï¼Œprompt_session_save.py æ³¨å…¥ [Session Save] æ¶ˆæ¯)_ |
| **Agent** | _(é™é»˜æ‰§è¡Œ)_ `save_summary --topic "è®¢å•æ¨¡å—å¼€å‘" --summary "è®¾è®¡å¹¶å®ç°äº†è®¢å•CRUD API..." --decisions "ä½¿ç”¨ENUM,åˆ†é¡µç”¨Cursor" --todos "æ·»åŠ æ”¯ä»˜é›†æˆ,ç¼–å†™æµ‹è¯•"` |

**éªŒè¯**:
```bash
tail -1 .cursor/skills/memory-data/sessions.jsonl | python3 -m json.tool
```
- [ ] æ–°å¢ä¸€æ¡åŒ…å« topic / summary / decisions / todos çš„æ‘˜è¦
- [ ] ä¸‹æ¬¡æ–°ä¼šè¯å¼€å§‹æ—¶ï¼ŒAgent èƒ½å¼•ç”¨è¿™ä¸ªæ‘˜è¦

---

## 5. ç”¨æˆ·ä¸»åŠ¨æ“ä½œ

### TC-5.1 æ‰‹åŠ¨è®°ä½ä¿¡æ¯

**ç”¨æˆ·è¾“å…¥**:
```
è®°ä½è¿™ä¸ªï¼šæˆ‘ä»¬çš„ä»£ç è§„èŒƒè¦æ±‚æ‰€æœ‰å‡½æ•°å¿…é¡»æœ‰ docstring
```

**é¢„æœŸ Agent è¡Œä¸º**: ç›´æ¥ç¼–è¾‘ `MEMORY.md`ï¼Œè¿½åŠ è¿™æ¡ä¿¡æ¯ã€‚

**ä¼šè¯ demo**:

| è§’è‰² | å†…å®¹ |
|------|------|
| **ç”¨æˆ·** | è®°ä½è¿™ä¸ªï¼šæˆ‘ä»¬çš„ä»£ç è§„èŒƒè¦æ±‚æ‰€æœ‰å‡½æ•°å¿…é¡»æœ‰ docstring |
| **Agent** | å·²è®°å½•åˆ°æ ¸å¿ƒè®°å¿†ä¸­ã€‚ä»¥åæˆ‘ä¼šç¡®ä¿æ‰€æœ‰å‡½æ•°éƒ½åŒ…å« docstringã€‚ |

**éªŒè¯**:
```bash
cat .cursor/skills/memory-data/MEMORY.md
```
- [ ] æ–‡ä»¶æœ«å°¾åŒ…å« docstring è§„èŒƒçš„è®°å½•

### TC-5.2 æœç´¢è®°å¿†

**ç”¨æˆ·è¾“å…¥**:
```
æœç´¢ä¸€ä¸‹æˆ‘ä»¬ä¹‹å‰å…³äºæ•°æ®åº“çš„è®¨è®º
```

**ä¼šè¯ demo**:

| è§’è‰² | å†…å®¹ |
|------|------|
| **ç”¨æˆ·** | æœç´¢ä¸€ä¸‹æˆ‘ä»¬ä¹‹å‰å…³äºæ•°æ®åº“çš„è®¨è®º |
| **Agent** | æœç´¢è®°å¿†ä¸­...<br><br>æ‰¾åˆ° 3 æ¡ç›¸å…³è®°å¿†ï¼š<br><br>1. [W] é¡¹ç›®ä½¿ç”¨ PostgreSQL æ•°æ®åº“ï¼ˆ0.95ï¼‰<br>   æ—¥æœŸ: 2026-02-18<br><br>2. [W] è®¢å•çŠ¶æ€ä½¿ç”¨ PostgreSQL ENUM ç±»å‹ï¼ˆ0.9ï¼‰<br>   æ—¥æœŸ: 2026-02-19<br><br>3. [S] ä¼šè¯æ‘˜è¦ï¼šæ•°æ®åº“é€‰å‹è®¨è®º<br>   æ—¥æœŸ: 2026-02-16 |

### TC-5.3 ç®¡ç†è®°å¿†

**ç”¨æˆ·è¾“å…¥**:
```
å¸®æˆ‘çœ‹ä¸€ä¸‹è®°å¿†ç»Ÿè®¡
```

**ä¼šè¯ demo**:

| è§’è‰² | å†…å®¹ |
|------|------|
| **ç”¨æˆ·** | å¸®æˆ‘çœ‹ä¸€ä¸‹è®°å¿†ç»Ÿè®¡ |
| **Agent** | ğŸ“Š è®°å¿†ç»Ÿè®¡<br><br>â€¢ æ ¸å¿ƒè®°å¿†: 856 å­—ç¬¦<br>â€¢ äº‹å®è®°å½•: 47 æ¡ï¼ˆW:28 / B:11 / O:8ï¼‰<br>â€¢ ä¼šè¯æ‘˜è¦: 12 æ¡<br>â€¢ æœ€è¿‘ 7 å¤©æ´»è·ƒ<br>â€¢ ç£ç›˜: 156 KB |

### TC-5.4 åˆ é™¤è®°å¿†

**ç”¨æˆ·è¾“å…¥**:
```
åˆ é™¤å…³äº MySQL çš„è®°å¿†
```

**ä¼šè¯ demo**:

| è§’è‰² | å†…å®¹ |
|------|------|
| **ç”¨æˆ·** | åˆ é™¤å…³äº MySQL çš„è®°å¿† |
| **Agent** | æœç´¢åŒ…å« "MySQL" çš„è®°å¿†...<br><br>æ‰¾åˆ° 2 æ¡ï¼š<br>1. [W] æ—§é¡¹ç›®ä½¿ç”¨ MySQL 5.7 (2026-02-15)<br>2. [W] MySQL è¿æ¥é…ç½® (2026-02-15)<br><br>å·²åˆ é™¤ 2 æ¡è®°å¿†ï¼Œç´¢å¼•å·²æ›´æ–°ã€‚ |

---

## 6. è·¨ä¼šè¯è®°å¿†éªŒè¯

### TC-6.1 å®Œæ•´è·¨ä¼šè¯æµ‹è¯•

**ä¼šè¯ A**:

| è§’è‰² | å†…å®¹ |
|------|------|
| **ç”¨æˆ·** | æˆ‘ä»¬å†³å®šç”¨ Redis åšç¼“å­˜å±‚ï¼ŒTTL è®¾ä¸º 300 ç§’ |
| **Agent** | å¥½çš„ï¼Œä½¿ç”¨ Redis ç¼“å­˜ï¼ŒTTL 300 ç§’ã€‚æˆ‘æ¥é…ç½®... |
| **ç”¨æˆ·** | å¥½äº†ï¼Œä»Šå¤©å°±åˆ°è¿™ |
| **Agent** | å†è§ï¼_(stop Hook è‡ªåŠ¨ä¿å­˜æ‘˜è¦)_ |

**ä¼šè¯ Bï¼ˆæ–°å¼€ä¸€ä¸ªå¯¹è¯ï¼‰**:

| è§’è‰² | å†…å®¹ |
|------|------|
| **ç³»ç»Ÿ** | _(sessionStart Hook åŠ è½½è®°å¿†)_ |
| **ç”¨æˆ·** | æˆ‘ä»¬ä¹‹å‰å†³å®šç”¨ä»€ä¹ˆåšç¼“å­˜ï¼ŸTTL æ˜¯å¤šå°‘ï¼Ÿ |
| **Agent** | æ ¹æ®ä¹‹å‰çš„è®°å¿†ï¼Œä½ ä»¬å†³å®šä½¿ç”¨ **Redis** åšç¼“å­˜å±‚ï¼Œ**TTL è®¾ä¸º 300 ç§’**ã€‚ |

**éªŒè¯**:
- [ ] ä¼šè¯ B çš„ Agent èƒ½å‡†ç¡®å›ç­” Redis å’Œ 300 ç§’

---

## 7. è¾¹ç•Œåœºæ™¯

### TC-7.1 ç©ºé¡¹ç›®ï¼ˆæ— ä»»ä½•è®°å¿†ï¼‰

**ç”¨æˆ·è¾“å…¥**ï¼ˆæ–°é¡¹ç›®ï¼Œé¦–æ¬¡ä½¿ç”¨ï¼‰:
```
è¿™ä¸ªé¡¹ç›®ç”¨ä»€ä¹ˆæŠ€æœ¯æ ˆï¼Ÿ
```

**é¢„æœŸ**: Agent ä¸ä¼šç¼–é€ è®°å¿†ï¼Œè€Œæ˜¯è¡¨ç¤ºæ²¡æœ‰ç›¸å…³ä¿¡æ¯æˆ–è¯¢é—®ç”¨æˆ·ã€‚

### TC-7.2 interrupted ä¼šè¯ä¸ä¿å­˜

**åœºæ™¯**: ç”¨æˆ·ä¸­é€”å…³é—­ Cursor çª—å£ã€‚

**é¢„æœŸ**: stop Hook æ”¶åˆ° `status: interrupted`ï¼Œä¸ç”Ÿæˆ `followup_message`ï¼Œä¸ä¿å­˜æ‘˜è¦ã€‚

### TC-7.3 çŸ­ä¼šè¯çš„äº‹å®è¡¥å……

**åœºæ™¯**: çŸ­ä¼šè¯ï¼ˆpreCompact æœªè§¦å‘ï¼‰ï¼Œä½† stop Hook æ£€æµ‹åˆ° completedã€‚

**é¢„æœŸ**: Agent åœ¨ä¿å­˜æ‘˜è¦çš„åŒæ—¶ï¼Œä¹Ÿç”¨ `save_fact` æå–ä¼šè¯ä¸­çš„å…³é”®äº‹å®ã€‚

---

## 8. æ•°æ®å®Œæ•´æ€§æ£€æŸ¥

æ¯æ¬¡æµ‹è¯•åè¿è¡Œï¼š

```bash
# æ£€æŸ¥æ ¸å¿ƒè®°å¿†
echo "=== MEMORY.md ==="
cat .cursor/skills/memory-data/MEMORY.md

# æ£€æŸ¥ä»Šæ—¥äº‹å®
echo "=== daily ==="
cat .cursor/skills/memory-data/daily/$(date +%Y-%m-%d).jsonl 2>/dev/null | python3 -m json.tool || echo "(empty)"

# æ£€æŸ¥ä¼šè¯æ‘˜è¦
echo "=== sessions ==="
cat .cursor/skills/memory-data/sessions.jsonl 2>/dev/null | python3 -m json.tool || echo "(empty)"

# éªŒè¯ JSONL æ ¼å¼
for f in .cursor/skills/memory-data/daily/*.jsonl .cursor/skills/memory-data/sessions.jsonl; do
  [ -f "$f" ] && python3 -c "
import json
with open('$f') as fh:
    lines = [l for l in fh if l.strip()]
    errors = [i for i,l in enumerate(lines,1) if not l.strip()]
    for i,l in enumerate(lines,1):
        try: json.loads(l)
        except: errors.append(i)
    print(f'{len(lines)} lines, errors: {errors or \"none\"}  [{f}]')
"
done
```

---

## 9. è‡ªç„¶è¯­è¨€é…ç½®ç®¡ç†

### TC-9.1 æŸ¥çœ‹å½“å‰é…ç½®

**ç”¨æˆ·è¾“å…¥**:
```
å¸®æˆ‘çœ‹ä¸€ä¸‹ç°åœ¨çš„è®°å¿†é…ç½®
```

**ä¼šè¯ demo**:

| è§’è‰² | å†…å®¹ |
|------|------|
| **ç”¨æˆ·** | å¸®æˆ‘çœ‹ä¸€ä¸‹ç°åœ¨çš„è®°å¿†é…ç½® |
| **Agent** | å½“å‰é…ç½®ï¼š<br>â€¢ å…¨é‡åŠ è½½å¤©æ•°: 2 å¤©<br>â€¢ éƒ¨åˆ†åŠ è½½å¤©æ•°: 5 å¤©ï¼ˆæ¯å¤© 3 æ¡ï¼‰<br>â€¢ æœ€å¤§åŠ è½½å¤©æ•°: 7 å¤©<br>â€¢ äº‹å®ä¸Šé™: 15 æ¡<br>â€¢ åµŒå…¥æ¨¡å‹: BAAI/bge-small-zh-v1.5<br>â€¢ æ—¥å¿—çº§åˆ«: INFO |

**éªŒè¯**:
```bash
python3 .cursor/skills/memory/scripts/service/manage/index.py config show
```
- [ ] è¾“å‡º JSON åŒ…å«æ‰€æœ‰é…ç½®åˆ†ç»„
- [ ] å€¼ä¸é»˜è®¤å€¼æˆ–é¡¹ç›®é…ç½®ä¸€è‡´

### TC-9.2 ä¿®æ”¹é…ç½®

**ç”¨æˆ·è¾“å…¥**:
```
å¤šåŠ è½½å‡ å¤©çš„è®°å¿†ï¼Œå…¨é‡åŠ è½½æ”¹æˆ5å¤©
```

**é¢„æœŸ Agent è¡Œä¸º**: æ‰§è¡Œ `config set memory.load_days_full 5`

**ä¼šè¯ demo**:

| è§’è‰² | å†…å®¹ |
|------|------|
| **ç”¨æˆ·** | å¤šåŠ è½½å‡ å¤©çš„è®°å¿†ï¼Œå…¨é‡åŠ è½½æ”¹æˆ5å¤© |
| **Agent** | å·²å°† memory.load_days_full ä» 2 è°ƒæ•´ä¸º 5ã€‚ |

**éªŒè¯**:
```bash
python3 .cursor/skills/memory/scripts/service/manage/index.py config get memory.load_days_full
cat .cursor/skills/memory-data/config.json | python3 -m json.tool
```
- [ ] config.json ä¸­ memory.load_days_full å€¼ä¸º 5
- [ ] config get è¿”å›å€¼ä¸º 5ï¼Œsource ä¸º project

### TC-9.3 ä¿®æ”¹éœ€è¦é‡å»ºç´¢å¼•çš„é…ç½®

**ç”¨æˆ·è¾“å…¥**:
```
æ¢ä¸€ä¸ªåµŒå…¥æ¨¡å‹ï¼Œç”¨ BAAI/bge-base-zh-v1.5
```

**é¢„æœŸ Agent è¡Œä¸º**: æ‰§è¡Œ `config set embedding.model "BAAI/bge-base-zh-v1.5"`ï¼Œå¹¶æç¤ºéœ€è¦é‡å»ºç´¢å¼•

**éªŒè¯**:
- [ ] Agent æç¤ºéœ€è¦æ‰§è¡Œ `rebuild-index --full`
- [ ] config.json ä¸­ embedding.model å·²æ›´æ–°

### TC-9.4 é‡ç½®é…ç½®

**ç”¨æˆ·è¾“å…¥**:
```
æŠŠäº‹å®åŠ è½½ä¸Šé™æ¢å¤é»˜è®¤
```

**é¢„æœŸ Agent è¡Œä¸º**: æ‰§è¡Œ `config reset memory.facts_limit`

**éªŒè¯**:
```bash
python3 .cursor/skills/memory/scripts/service/manage/index.py config get memory.facts_limit
```
- [ ] å€¼æ¢å¤ä¸ºé»˜è®¤å€¼ 15

---

## 10. SQLite æ•°æ®åº“æŸ¥çœ‹

### TC-10.1 æŸ¥çœ‹æ•°æ®åº“ç»Ÿè®¡

**ç”¨æˆ·è¾“å…¥**:
```
å¸®æˆ‘çœ‹ä¸€ä¸‹æ•°æ®åº“é‡Œå­˜äº†ä»€ä¹ˆ
```

**ä¼šè¯ demo**:

| è§’è‰² | å†…å®¹ |
|------|------|
| **ç”¨æˆ·** | å¸®æˆ‘çœ‹ä¸€ä¸‹æ•°æ®åº“é‡Œå­˜äº†ä»€ä¹ˆ |
| **Agent** | ğŸ“Š ç´¢å¼•æ•°æ®åº“ç»Ÿè®¡<br><br>â€¢ æ•°æ®åº“å¤§å°: 256 KB<br>â€¢ æ€» chunk æ•°: 42<br>â€¢ å«å‘é‡ç´¢å¼•: 42 æ¡<br><br>æŒ‰ç±»å‹: fact 35 / core 4 / summary 3<br>æŒ‰è®°å¿†ç±»å‹: W 25 / B 6 / O 4 |

**éªŒè¯**:
```bash
python3 .cursor/skills/memory/scripts/service/manage/index.py db stats
```
- [ ] è¾“å‡º JSON åŒ…å« total_chunks / by_type / by_memory_type / file_size_kb

### TC-10.2 æŸ¥çœ‹è¡¨åˆ—è¡¨

**ç”¨æˆ·è¾“å…¥**:
```
æ•°æ®åº“é‡Œæœ‰å“ªäº›è¡¨
```

**éªŒè¯**:
```bash
python3 .cursor/skills/memory/scripts/service/manage/index.py db tables
```
- [ ] è¾“å‡ºåŒ…å« chunks / meta / sync_state è¡¨åŠè¡Œæ•°

### TC-10.3 æŸ¥çœ‹ç´¢å¼•å†…å®¹

**ç”¨æˆ·è¾“å…¥**:
```
çœ‹ä¸€ä¸‹ç´¢å¼•é‡Œæœ€è¿‘çš„è®°å½•
```

**é¢„æœŸ Agent è¡Œä¸º**: æ‰§è¡Œ `db show chunks --limit 10`

**éªŒè¯**:
```bash
python3 .cursor/skills/memory/scripts/service/manage/index.py db show chunks --limit 5
```
- [ ] è¾“å‡ºåŒ…å« id / content / type / memory_type / timestamp
- [ ] embedding å­—æ®µæ˜¾ç¤ºä¸º `<blob N bytes>` è€ŒéåŸå§‹äºŒè¿›åˆ¶

### TC-10.4 è‡ªå®šä¹‰æŸ¥è¯¢

**ç”¨æˆ·è¾“å…¥**:
```
æŸ¥ä¸€ä¸‹åŒ…å« PostgreSQL çš„è®°å½•
```

**é¢„æœŸ Agent è¡Œä¸º**: æ‰§è¡Œ `db query "SELECT id, content, type FROM chunks WHERE content LIKE '%PostgreSQL%'"`

**éªŒè¯**:
```bash
python3 .cursor/skills/memory/scripts/service/manage/index.py db query "SELECT id, content FROM chunks WHERE content LIKE '%PostgreSQL%'"
```
- [ ] è¿”å›åŒ¹é…çš„è®°å½•
- [ ] ä¸å…è®¸ DELETE / UPDATE ç­‰å†™æ“ä½œ

### TC-10.5 æµè§ˆå™¨å¯è§†åŒ–æŸ¥çœ‹

**ç”¨æˆ·è¾“å…¥**:
```
åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€æ•°æ®åº“çœ‹çœ‹
```

**é¢„æœŸ Agent è¡Œä¸º**: æ‰§è¡Œ `db browse`ï¼Œå¯åŠ¨ datasette å¹¶æ‰“å¼€æµè§ˆå™¨

**éªŒè¯**:
```bash
python3 .cursor/skills/memory/scripts/service/manage/index.py db browse
```
- [ ] æµè§ˆå™¨è‡ªåŠ¨æ‰“å¼€ http://localhost:8685
- [ ] ç½‘é¡µä¸­å¯ä»¥çœ‹åˆ°æ‰€æœ‰è¡¨å’Œæ•°æ®
- [ ] å¯ä»¥æ‰§è¡Œ SQL æŸ¥è¯¢
- [ ] Ctrl+C å¯ä»¥æ­£å¸¸å…³é—­

**å‰ç½®æ¡ä»¶**: éœ€è¦å®‰è£… datasetteï¼ˆ`pip install datasette`ï¼‰

### TC-10.6 æ•°æ®åº“ä¸å­˜åœ¨æ—¶çš„é”™è¯¯å¤„ç†

**åœºæ™¯**: åœ¨æ²¡æœ‰æ‰§è¡Œè¿‡ sync_index çš„æ–°é¡¹ç›®ä¸­æŸ¥çœ‹æ•°æ®åº“

**éªŒè¯**:
```bash
python3 .cursor/skills/memory/scripts/service/manage/index.py db tables
```
- [ ] è¿”å› error çŠ¶æ€ï¼Œcode ä¸º DB_NOT_FOUND
- [ ] é”™è¯¯ä¿¡æ¯åŒ…å«æ•°æ®åº“æ–‡ä»¶è·¯å¾„

---

## 11. Hook æ—¥å¿—éªŒè¯

### TC-11.1 éªŒè¯æ‰€æœ‰ Hook éƒ½æœ‰æ—¥å¿—

**åœºæ™¯**: å®Œæˆä¸€æ¬¡å®Œæ•´çš„ä¼šè¯ç”Ÿå‘½å‘¨æœŸåï¼Œæ£€æŸ¥æ—¥å¿—æ–‡ä»¶ã€‚

**éªŒè¯**:
```bash
cat .cursor/skills/memory-data/logs/$(date +%Y-%m-%d).log
```

**é¢„æœŸæ—¥å¿—åŒ…å«**:
- [ ] `[memory.load]` â€” sessionStart åŠ è½½è®°å¿†
- [ ] `[memory.flush_memory]` â€” preCompact è§¦å‘ï¼ˆä»…é•¿å¯¹è¯ï¼‰
- [ ] `[memory.stop_hook]` â€” stop è§¦å‘
- [ ] `[memory.save_summary]` â€” æ‘˜è¦ä¿å­˜
- [ ] `[memory.save_fact]` â€” äº‹å®ä¿å­˜
- [ ] `[memory.end_session]` â€” sessionEnd åŒæ­¥å’Œæ¸…ç†
- [ ] `[memory.sync]` â€” ç´¢å¼•åŒæ­¥
